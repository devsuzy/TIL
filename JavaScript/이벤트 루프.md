# 이벤트 루프

> 매일메일 FE 2025년 1월 1주차 금요일 질문

### 이벤트 루프란?

- 싱글 스레드인 자바스크립트의 작업을 멀티 스레드로 돌려 작업을 동시 처리함
- 태스크가 들어오길 기다렸다가 태스크가 들어오면 이를 처리하고, 처리할 태스크가 없으면 잠드는 자바스크립트 내 루프

### 이벤트 루프의 구조

**자바스크립트 엔진 내부: 메모리 힙과 콜 스택**

- 메모리 힙 (Memory Heap)
  - 객체, 배열, 함수 등 데이터가 저장되는 공간
- 콜 스택 (Call Stack)
  - 자바스크립트의 할 일 목록
  - FILO: 먼저 들어간 것이 마지막에 나감감

**자바스크립트 엔진 외부: 웹 API, 콜백 큐**

- 웹 API (Web APIs)
  - 브라우저가 제공하는 다양한 기능
  - 주로 비동기적 처리가 되므로 정확한 완료 시점을 알 수 없음
- 콜백 큐 (Callback Queue)
  - 비동기 작업의 결과나 나중에 실행되어야 하는 작업들이 대기하는 공간
  - FIFO: 먼저 들어간 작업이 먼저 나감

**콜백 큐의 세 가지 종류**

1. 매크로태스크 큐 (Macrotask Queue)
   - 일반적인 비동기 작업들이 대기하는 큐
   - 콜 스택과 마이크로태스크 큐의 작업을 모두 처리한 후 하나씩만 처리함
   - `setTimeout`, `setInterval`
2. 마이크로태스크 큐 (Microtask Queue)
   - 중요도가 높은 작업들이 대기하는 큐
   - 매크로태스크 큐보다 우선순위가 높아 우선 실행 됨
   - `Promise.then()`, `async`, `await`
3. 애니메이션 프레임 (Animation Frames)
   - `requestAnimationFrames`

**마이크로태스크 큐 > 애니메이션 프레임 > 매크로태스크 큐 순으로 실행**

### 이벤트 루프 동작 과정

1. 콜 스택 확인
   - 콜 스택이 비어 있는지 확인
   - 콜 스택에 처리가 되지 않은 함수가 있다면, 해당 함수가 완전히 실행될 때까지 기다림
2. 콜백 큐 확인
   - 콜 스택이 비어있다면, 콜백 큐 확인
   - 주로 웹 API에서 생성된 콜백 함수들이 대기하고 있음
3. 함수 이동
   - 콜백 큐에서 가장 오래된 함수를 콜 스택으로 옮김
4. 함수 실행
   - 해당 함수가 콜 스택에서 실행되고, 실행이 끝나면 콜 스택에서 빠져나감
5. 위 과정들을 프로그램이 종료될 때까지 반복
