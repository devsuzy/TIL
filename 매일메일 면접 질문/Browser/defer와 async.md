# defer와 async

> 매일메일 FE 2025년 1월 4주차 월요일 질문

### script 태그
- 브라우저가 script를 만났을 때
    - HTML을 읽다가 `<script>...</script>`태그를 만나면 스크립트를 먼저 실행하기 위해 DOM 생성을 멈춘다.
    - 외부 스크립트인 `<script src="..."></script>`를 만났을 때도 마찬가지로 외부 스크립트를 다운받고 실행한 후 남은 페이지를 처리한다.
- 문제점
    - 스크립트는 스크립트 아래 있는 DOM 요소에 접근할 수 없다.
    - DOM 요소에 핸들러를 추가할 수 없다.
    - 스크립트를 다운받고 실행할 때까지 스크립트 아래쪽 페이지를 볼 수 없다.

### defer
- 스크립트를 비동기적으로 다운로드한다.
- 브라우저는 `defer` 속성이 있는 스크립트를 백그라운드에서 다운로드한다.
    - 스크립트를 다운하는 도중에도 HTML 파싱이 멈추지 않는다.
- `DOMContentLoaded` 이벤트 발생 직전에 실행된다.
- **여러 `defer` 스크립트가 있을 경우, HTML에 작성된 순서대로 실행된다.**
    - 문서에 추가된 순으로 실행된다.
    - 길이가 긴 스크립트가 앞에, 길이가 짧은 스크립트가 뒤에 있어도 짧은 스크립트는 긴 스크립트가 실행될 때까지 기다린다.
- `defer` 속성은 외부 스크립트에만 유효하다.
    - `<script>`에 src가 없으면 `defer` 속성은 무시된다.
- 실행 순서가 중요한 스크립트나 메인 로직을 담고 있는 경우에 유용하다.

### async
- 스크립트를 비동기적으로 다운로드한다.
- 브라우저는 `async` 속성이 있는 스크립트를 백그라운드에서 다운로드한다.
    - HTML 파싱과 병렬로 진행되지만, 스크립트 실행 시 HTML 파싱이 잠시 중단된다.
- `DOMContentLoaded` 이벤트와 `async` 스크립트는 서로를 기다리지 않는다.
    - 페이지 구성이 끝난 후에 `async` 스크립트 다운로딩이 끝난 경우, `DOMContentLoaded`는 `async` 스크립트 실행 전에 발생할 수 있다.
    - `async` 스크립트가 짧아서 페이지 구성이 끝나기 전에 다운로드 되거나 스크립트가 캐싱처리 된 경우, `DOMContentLoaded`는 `async` 스크립트 실행 후에 발생할 수도 있다.
- **여러 `async` 스크립트가 있을 경우, 다운로드가 끝난 스크립트 순으로 실행된다.**
    - load-first order => 문서 내 순서와 상관없이 먼저 다운로드된 스크립트가 먼저 실행된다.
- 방문자 수, 카운터, 광고, 분석 도구 관련 스크립트처럼 각각 독립적인 역할을 하는 경우에 유용하다.